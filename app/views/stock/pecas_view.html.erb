<script>
  $(document).ready(function() {
    // pega a mudança do checkbox e submete o form
    $(":checkbox").change(function() {
      $('#garmentForm').submit();
    });

    // pega a mudança do select e submete o form
    $("select").change(function() {
      $('#garmentForm').submit();
    });
  });
</script>

<style>
  /* td.sim {
    background-color: #F5FFF8;
  }

  td.nao {
    background-color: #FFF5F5;
  } */

  .table-wrapper {
    max-width: 350px;
  }
</style>

<h1>Estoque de Peças</h1>

<%= form_with(url: pecas_view_stock_path, method: :get, html: { id: "garmentForm" }) do |f| %>
  <%= f.submit "Buscar", id: "submitButton", style: "display: none;" %>

  <div class="table-wrapper">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Tipo de Peça</span></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <%= f.select :tipo_peca_id, @garment_types.collect { |garment_type| [garment_type.nome, garment_type.id] }, { include_blank: "Todos", selected: params[:tipo_peca_id] }, { class: "form-select" } %>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="table-container">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>Tipo de Peça</th>
          <th>
            <%= f.check_box :costurada, {checked: params[:costurada] == '1'}, "1", "0" %> 
            <%= f.label :costurada, "Costurada" %>
          </th>
          <th>
            <%= f.check_box :estampada, {checked: params[:estampada] == '1'}, "1", "0" %> 
            <%= f.label :estampada, "Estampada" %>
          </th>
          <th>Quantidade</th>
          <th>Ultima Atualização</th>
        </tr>
      </thead>
      <tbody>
        <% @garment_stocks_groups.group_by { |(tipo, costurada, estampada), garment_stock| garment_stock.last.tipo_peca.nome }.each do |tipo_peca, grupos| %>
          <% grupos.each do |(tipo, costurada, estampada), garment_stock| %>
            <tr>
              <td><%= garment_stock.last.tipo_peca.nome %></td>
              <td class="<%= garment_stock.last.costurada ? 'sim' : 'nao' %>"><%= garment_stock.last.costurada ? "Sim" : "Não" %></td>
              <td class="<%= garment_stock.last.estampada ? 'sim' : 'nao' %>"><%= garment_stock.last.estampada ? "Sim" : "Não" %></td>
              <td><%= garment_stock.last.saldo %></td>
              <td><%= garment_stock.last.data_hora.strftime("%d/%m/%Y %H:%M") %></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
<% end %>