<script>
  function changePerPage(select) {
    const selectedValue = select.value;
    const currentParams = <%= raw(request.params.except("controller", "action").to_json) %>;
    currentParams["quant"] = selectedValue;
    window.location.href = '<%= financial_records_path %>' + '?' + new URLSearchParams(currentParams);
  }
</script>

<h1>Registros Financeiros</h1>
<br>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>
        <div class="form-group">
          <label for="entidade">Entidade:</label>
          <select class="form-control" id="entidade">
            <option value="option0">Todos</option>
            <option value="option1">Entidade 1</option>
            <option value="option2">Entidade 2</option>
          </select>
        </div>
      </th>
      <th>
        <div class="form-group">
          <label for="tipo_movimento">Tipo de Movimento:</label>
          <select class="form-control" id="tipo_movimento">
            <option value="option0">Todos</option>
            <option value="option1" selected>Saída</option>
            <option value="option2">Entrada</option>
          </select>
        </div>
      </th>
      <th>
        <div class="form-group">
          <label for="data_inicio">Data de Início:</label>
          <input type="date" class="form-control" id="data_inicio">
        </div>
      </th>
      <th>
        <div class="form-group">
          <label for="data_fim">Data de Fim:</label>
          <input type="date" class="form-control" id="data_fim">
        </div>
      </th>
      <th>
        <div class="form-group">
          <label for="observation">Filtrar por Observação:</label>
          <input type="text" class="form-control" id="observation">
        </div>
      </th>
    </tr>
  </thead>
</table>


<table class="table table-striped table-bordered">
  <thead class="thead-light">
    <tr>
      <td colspan="6">
        <strong>Saldo: </strong>
        <%= number_to_currency(@saldo, unit: 'R$', separator: ',', delimiter: '.') %>
        <button class="btn btn-primary" id="filtro_btn" style="float: right;">Filtrar</button>
        <%= link_to 'Novo Registro', new_financial_record_path, class: 'btn btn-primary', style: 'float: right; margin-right: 10px;' %>
      </td>
    </tr>
    <tr>
      <th>Tipo Movimento</th>
      <th>Valor</th>
      <th>Saldo</th>
      <th>Observação</th>
      <th>Data Hora</th>
      <th>Entidade</th>
    </tr>
  </thead>
  <tbody>
    <% @financial_records.each_with_index do |financial_record, index| %>
      <tr>
        <td><%= financial_record[:tipo_movimento] %></td>
        <td><%= number_to_currency(financial_record.valor, unit: 'R$', separator: ',', delimiter: '.') %></td>
        <td><%= number_to_currency(financial_record.saldo, unit: 'R$', separator: ',', delimiter: '.') %></td>
        <td><%= financial_record[:observacao] %></td>
        <td><%= financial_record.data_hora.strftime("%d/%m/%Y %H:%M:%S") %></td>
        <td><%= financial_record[:entidade] %></td>
      </tr>
    <% end %>
    <%# verifica se tem o numero de pagy.items %>
    <% if @financial_records.count < @pagy.items %>
      <%# se tiver, preenche o resto da tabela com linhas vazias %>
      <% (@pagy.items - @financial_records.count).times do %>
        <tr> <%# campo vazio, mas com espaço de como se tivesse algo %>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>    
      <% end %>
    <% end %>
  </tbody>
</table>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <% if @pagy.prev %>
      <li class="page-item">
        <%= link_to "Anterior", request.params.merge(page: @pagy.prev), class: "page-link" %>
      </li>
    <% else %>
      <li class="page-item disabled">
        <span class="page-link">Anterior</span>
      </li>
    <% end %>

    <% @pagy.series.each do |page| %>
      <% if page.is_a?(Integer) %>
        <% if page == @pagy.page %>
          <li class="page-item active" aria-current="page">
            <span class="page-link"><%= page %></span>
          </li>
        <% else %>
          <li class="page-item">
            <%= link_to page, request.params.merge(page: page), class: "page-link" %>
          </li>
        <% end %>
      <% else %>
        <li class="page-item">
          <% if page.is_a?(String)  %>
            <span class="page-link active"><%= page %></span>
          <% else %>
            <span class="page-link disabled">&hellip;</span>
          <% end %>
        </li>
      <% end %>
    <% end %>

    <% if @pagy.next %>
      <li class="page-item">
        <%= link_to "Próximo", request.params.merge(page: @pagy.next), class: "page-link" %>
      </li>
    <% else %>
      <li class="page-item disabled">
        <span class="page-link">Próximo</span>
      </li>
    <% end %>
  </ul>
  
  <div style="display: flex; align-items: center;">
    <label style="margin-right: 10px;">Itens por página: </label>
    <%= select_tag :quant, options_for_select(@quant_items, @pagy.items), class: "form-control", onchange: "changePerPage(this)", style: "width: 40px;" %>
  </div>
</nav>

<!-- Botão de Impressão -->
<%# <button class="btn btn-secondary" style="float: right;">Imprimir</button> %>